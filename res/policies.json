{
  "policies": [
    {
      "id": "no_password_login",
      "title": "Запрет входа в систему без пароля",
      "section": "Настройка авторизации",
      "subsection": "Параметры графического входа",
      "scope": "system",
      "dm": "any",
      "description": "Отключение автоматического входа без запроса пароля для LightDM, GDM, SDDM.",
      "apply": [
        {
          "type": "cmd",
          "dm": "lightdm",
          "run": ["/bin/sh","-c","if [ -d /etc/lightdm/lightdm.conf.d ]; then printf '[Seat:*]\\nautologin-user=\\n' | tee /etc/lightdm/lightdm.conf.d/50-altcenter-no-autologin.conf >/dev/null; elif [ -f /etc/lightdm/lightdm.conf ]; then sed -i -r '/^\\s*autologin-user\\s*=.*/d' /etc/lightdm/lightdm.conf; fi" ]
        },
        {
          "type": "cmd",
          "dm": "gdm",
          "run": ["/bin/sh","-c","if [ -d /etc/gdm ]; then if [ -f /etc/gdm/custom.conf ]; then if grep -q '^\\[daemon\\]' /etc/gdm/custom.conf; then sed -i -r 's/^\\s*AutomaticLoginEnable\\s*=.*/AutomaticLoginEnable=false/' /etc/gdm/custom.conf; else printf '[daemon]\\nAutomaticLoginEnable=false\\n' >> /etc/gdm/custom.conf; fi; else printf '[daemon]\\nAutomaticLoginEnable=false\\n' > /etc/gdm/custom.conf; fi; fi" ]
        },
        {
          "type": "cmd",
          "dm": "sddm",
          "run": ["/bin/sh","-c","if [ -d /etc/sddm.conf.d ]; then printf '[Autologin]\\nUser=\\n' | tee /etc/sddm.conf.d/10-altcenter-no-autologin.conf >/dev/null; elif [ -f /etc/sddm.conf ]; then sed -i -r '/^\\s*User\\s*=.*/d' /etc/sddm.conf; fi" ]
        }
      ]
    },
    {
      "id": "hide_user_list",
      "title": "Скрыть список пользователей на экране входа",
      "section": "Настройка авторизации",
      "subsection": "Параметры графического входа",
      "scope": "system",
      "dm": "any",
      "description": "Скрывает список пользователей на экране входа и включает ручной ввод имени (LightDM/GDM/SDDM).",
      "apply": [
        {
          "type": "cmd",
          "dm": "lightdm",
          "run": ["/bin/sh","-c","if [ -d /etc/lightdm/lightdm.conf.d ]; then printf '[Seat:*]\\ngreeter-hide-users=true\\ngreeter-show-manual-login=true\\n' | tee /etc/lightdm/lightdm.conf.d/50-altcenter-hide-users.conf >/dev/null; elif [ -f /etc/lightdm/lightdm.conf ]; then sed -i -r '/^\\s*greeter-hide-users\\s*=.*/d;/^\\s*greeter-show-manual-login\\s*=.*/d' /etc/lightdm/lightdm.conf; printf '\\n[Seat:*]\\n' >> /etc/lightdm/lightdm.conf; printf 'greeter-hide-users=true\\ngreeter-show-manual-login=true\\n' >> /etc/lightdm/lightdm.conf; fi" ]
        },
        {
          "type": "cmd",
          "dm": "gdm",
          "run": ["/bin/sh","-c","if [ -d /etc/gdm ]; then mkdir -p /etc/dconf/db/gdm.d /etc/dconf/profile; printf 'user-db:user\\nsystem-db:gdm\\n' > /etc/dconf/profile/gdm; printf '[org/gnome/login-screen]\\ndisable-user-list=true\\n' > /etc/dconf/db/gdm.d/00-login-screen; dconf update; fi" ]
        },
        {
          "type": "cmd",
          "dm": "sddm",
          "run": ["/bin/sh","-c","if [ -d /etc/sddm.conf.d ]; then printf '[Users]\\nMinimumUid=100000\\nMaximumUid=999\\nRememberLastUser=false\\n' | tee /etc/sddm.conf.d/10-altcenter-hide-users.conf >/dev/null; rm -f /var/lib/sddm/state.conf 2>/dev/null || true; elif [ -f /etc/sddm.conf ]; then sed -i -r '/^\\s*MinimumUid\\s*=.*/d;/^\\s*MaximumUid\\s*=.*/d;/^\\s*RememberLastUser\\s*=.*/d' /etc/sddm.conf; printf '\\n[Users]\\nMinimumUid=100000\\nMaximumUid=999\\nRememberLastUser=false\\n' >> /etc/sddm.conf; rm -f /var/lib/sddm/state.conf 2>/dev/null || true; fi" ]
        }
      ]
    }
  ]
}
